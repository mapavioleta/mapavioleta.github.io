<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Violeta CNV üó∫Ô∏è Reprograma-T</title>
    
    <link rel="icon" href="favicon.ico" sizes="any"> 
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta name="theme-color" content="#9b59b6">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/app.css">
    <link rel="manifest" href="manifest.json">
    
    <style>
    /* Estilos Globais */
    :root {
        --mapa-violeta-cor-destaque: #9b59b6;
        --mapa-violeta-cor-destaque-hover: #8e44ad;
        --mapa-violeta-fundo-form: rgba(34, 28, 53, 0.95);
        --mapa-violeta-borda-form: rgba(155, 89, 182, 0.5);
        --mapa-violeta-cor-texto-form: #e0d0ff;
        --mapa-violeta-fundo-pagina: #0a0a14;
        --color-white: #FFFFFF;
        --font-principal: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; } 
    body {
        font-family: var(--font-principal);
        background-color: var(--mapa-violeta-fundo-pagina);
        color: #e0d0ff;
        display: flex;
        flex-direction: column;
        line-height: 1.6;
        overflow: hidden;
    }

    /* Header */
    .mobile-header {
        background: rgba(26, 26, 46, 0.9);
        padding: 15px 20px;
        border-bottom: 2px solid var(--mapa-violeta-cor-destaque);
        backdrop-filter: blur(10px);
    }

    .mobile-header h1 {
        color: var(--mapa-violeta-cor-destaque);
        font-size: 1.5em;
        text-align: center;
        text-shadow: 0 0 8px rgba(155, 89, 182, 0.5);
    }

    .mobile-header h1 i {
        margin-right: 10px;
    }

    /* √Årea Principal */
    .mapa-violeta-main-area {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }

    .mapa-violeta-header-secao {
        text-align: center;
        margin-bottom: 20px;
    }

    .mapa-violeta-header-secao h1 {
        color: var(--mapa-violeta-cor-destaque);
        font-size: 2em;
        margin-bottom: 10px;
    }

    .mapa-violeta-header-secao p.subtitulo-mapa {
        font-size: 1.05em;
        color: var(--mapa-violeta-cor-texto-form);
        max-width: 700px;
        margin: 0 auto 15px;
    }

    /* Mapa */
    #map {
        height: 65vh;
        min-height: 500px;
        width: 100%;
        border-radius: 10px;
        border: 2px solid var(--mapa-violeta-borda-form);
        box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        margin-bottom: 20px;
        background-color: #e0e0e0;
    }

    /* Bot√£o Flutuante */
    .fab-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
    }

    .fab {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--mapa-violeta-cor-destaque);
        border: none;
        color: white;
        font-size: 1.5em;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(155, 89, 182, 0.4);
        transition: all 0.3s ease;
    }

    .fab:hover {
        background: var(--mapa-violeta-cor-destaque-hover);
        transform: scale(1.05);
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 2000;
        align-items: center;
        justify-content: center;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: var(--mapa-violeta-fundo-form);
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        border-radius: 12px;
        border: 1px solid var(--mapa-violeta-borda-form);
        overflow-y: auto;
        color: var(--mapa-violeta-cor-texto-form);
    }

    .modal-header {
        padding: 20px;
        border-bottom: 1px solid var(--mapa-violeta-borda-form);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-header h3 {
        color: var(--mapa-violeta-cor-destaque);
        margin: 0;
    }

    .close-btn {
        background: none;
        border: none;
        color: var(--mapa-violeta-cor-texto-form);
        font-size: 1.5em;
        cursor: pointer;
    }

    .form-group {
        padding: 15px 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--mapa-violeta-cor-texto-form);
    }

    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 12px;
        background: rgba(0,0,0,0.3);
        border: 1px solid var(--mapa-violeta-borda-form);
        border-radius: 6px;
        color: var(--color-white);
        font-size: 1em;
    }

    .form-group textarea {
        min-height: 80px;
        resize: vertical;
    }

    .btn-primary {
        width: calc(100% - 40px);
        margin: 20px;
        padding: 15px;
        background: linear-gradient(135deg, var(--mapa-violeta-cor-destaque), #8e44ad);
        color: white;
        border: none;
        border-radius: 25px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(155, 89, 182, 0.4);
    }

    /* Popup do Mapa */
    .leaflet-popup-content-wrapper {
        background: #ffffff;
        color: #333333;
        border-radius: 8px;
        box-shadow: 0 3px 15px rgba(0,0,0,0.2);
    }

    .popup-marker-details {
        max-height: 280px;
        overflow-y: auto;
        padding: 10px;
    }

    .popup-marker-details h4 {
        color: var(--mapa-violeta-cor-destaque);
        margin-bottom: 10px;
    }

    /* Responsivo */
    @media (max-width: 768px) {
        .mapa-violeta-main-area { padding: 15px; }
        .mapa-violeta-header-secao h1 { font-size: 1.7em; }
        #map { height: 55vh; min-height: 400px; }
        .modal-content { width: 95%; margin: 20px; }
    }

    @media (max-width: 480px) {
        .mapa-violeta-main-area { padding: 10px; }
        .mapa-violeta-header-secao h1 { font-size: 1.5em; }
        #map { height: 50vh; min-height: 350px; }
    }
    </style>
</head>
<body class="pagina-mapa-violeta">
    <!-- Header Mobile -->
    <header class="mobile-header">
        <h1><i class="fas fa-map-marked-alt"></i> Mapa Violeta CNV</h1>
    </header>

    <!-- √Årea Principal -->
    <div class="app-main-container">
        <main class="main-content-area">
            <section class="mapa-violeta-main-area">
                <div class="mapa-violeta-header-secao">
                    <h1><i class="fas fa-map-marked-alt"></i> Mapa Violeta CNV</h1>
                    <p class="subtitulo-mapa">Partilhe suas experi√™ncias e observa√ß√µes. Clique no mapa para adicionar um registro.<br>
                    <span id="location-status-message" style="font-size:0.9em; opacity:0.8;">
                        Para ver outros usu√°rios pr√≥ximos, permita o acesso √† sua localiza√ß√£o.
                    </span></p>
                </div>
                
                <!-- Mapa -->
                <div id="map"></div>

                <!-- Bot√£o Flutuante -->
                <div class="fab-container">
                    <button id="fab-main" class="fab" title="Novo Registro">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>

                <!-- Modal do Formul√°rio -->
                <div id="form-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3><i class="fas fa-heartbeat"></i> Novo Registro</h3>
                            <button id="close-modal" class="close-btn">&times;</button>
                        </div>
                        <form id="cnv-form">
                            <input type="hidden" name="latitude" id="form-latitude">
                            <input type="hidden" name="longitude" id="form-longitude">
                            
                            <div class="form-group">
                                <label for="tipo_registro">Tipo de Registro:*</label>
                                <select name="tipo_registro" id="tipo_registro" required>
                                    <option value="">Selecione...</option>
                                    <option value="alerta_perigo">üö® Alerta de Perigo</option>
                                    <option value="local_acolhedor">üíñ Local Acolhedor</option>
                                    <option value="ponto_apoio">ü§ù Ponto de Apoio</option>
                                    <option value="evento_positivo">üéâ Evento Positivo</option>
                                    <option value="denuncia_violencia">üó£Ô∏è Den√∫ncia</option>
                                    <option value="reivindicacao_melhoria">üöß Reivindica√ß√£o</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="observacao">Observa√ß√£o (Fatos)*:</label>
                                <textarea name="observacao" id="observacao" required placeholder="Ex: Vi picha√ß√µes..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="sentimento">Sentimento*:</label>
                                <textarea name="sentimento" id="sentimento" required placeholder="Ex: Senti medo..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="necessidade">Necessidade*:</label>
                                <textarea name="necessidade" id="necessidade" required placeholder="Ex: Necessidade de seguran√ßa..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="pedido">Pedido*:</label>
                                <textarea name="pedido" id="pedido" required placeholder="Ex: Gostaria que a prefeitura limpasse..."></textarea>
                            </div>

                            <button type="submit" class="btn-primary">
                                <i class="fas fa-map-marker-alt"></i> Enviar Registro
                            </button>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="js/config.js"></script>
    <script src="js/app.js"></script>
    <script src="js/map.js"></script>
    <script src="js/api.js"></script>

    <script>
    // Configura√ß√£o b√°sica - ser√° sobrescrita pelo config.js
    const CONFIG = {
        API_BASE_URL: 'https://mapavioleta-github-io-3.onrender.com',
        MAP: {
            defaultCenter: [-23.1896, -45.8841],
            defaultZoom: 13
        }
    };

    // Inicializa√ß√£o b√°sica
    document.addEventListener('DOMContentLoaded', function() {
        const fabButton = document.getElementById('fab-main');
        const modal = document.getElementById('form-modal');
        const closeModal = document.getElementById('close-modal');
        const form = document.getElementById('cnv-form');

        // Abrir modal
        fabButton.addEventListener('click', function() {
            modal.classList.add('active');
        });

        // Fechar modal
        closeModal.addEventListener('click', function() {
            modal.classList.remove('active');
        });

        // Fechar modal clicando fora
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });

        // Submit do formul√°rio
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            if (!data.latitude || !data.longitude) {
                alert('Clique no mapa para definir a localiza√ß√£o primeiro!');
                return;
            }

            // Aqui voc√™ pode enviar para a API
            console.log('Dados do formul√°rio:', data);
            alert('Registro enviado com sucesso! (Demo)');
            modal.classList.remove('active');
            form.reset();
        });

        console.log('üåç Mapa Violeta CNV - Inicializado');
    });
    </script>
</body>
</html>
